---
layout: post
title: "《redis开发与运维》笔记(十)——热点key问题"
date: 2020-12-19
description: "《redis开发与运维》笔记(十)——热点key问题"
tag: Redis
--- 

#### 热点key是什么
什么是热点？比如微博某某明星时间管理多人运动此新闻在某一段时间内浏览量以及点击量非常的大，这种就属于热点。

#### 服务器如何抗热点数据的访问
大家都知道一般明星的绯闻新闻的访问量是非常的高，那么思考一下针对如此高的访问量，后端该如何做？？？才能避免数据库因不能扛住大量的并发读写而宕机，导致整个服务不可用？？？

当然第一时间就会想到缓存，通过缓存来对数据库的访问减轻压力。更有效的保护数据库层。但是任何东西都有自己的利与弊，在引入缓存之前我们得考虑这样做给我们会带来什么样的弊端？哪些坑是需要注意？这些坑该如何避免等问题？

#### 热点key带来的问题

比如热点key缓存失效时，如果不能快速的重建缓存（在某些情况下，构建一个缓存是需要执行复杂的sql，或者复杂的计算），此时所有的请求全部涌向数据库，造成数据库负载大，甚至让数据库崩溃也是有可能的。

#### 如何解决
当解决一个问题的时候，不能因为为了解决这个问题，导致其他的问题出现带来更多的麻烦，这样就得不偿失了。所以在解决的同时要注意如下几个问题
* 减少重构缓存的次数
* 数据尽可能的保持一致性
* 较少的潜在危险

方案

###### 互斥锁 
此方法是只允许一个线程去重建缓存。其余线程阻塞直到缓存构建完成。比如java中的锁或者利用redis实现分布式锁来实现。

优点

1：实现思路比较简单

2：能保证数据的一致性

3：有效的控制数据库的负载

缺点

1：如果重建缓存的时间过长，容易造成线程的阻塞

###### 永不过期
“永不过期”包含两层意思
* 从redis缓存的层面上来看的话就是不设置过期时间。
* 从功能层面来看，为每个value设置过期时间，什么意思了？就是在逻辑层面上将value设置一个过期时间了，单独起一个线程监控，一旦发现过期就将缓存重建。

优点

1：彻底解决了热点key失效所带来的问题

缺点

1：代码实现复杂度高

2：会存在数据短暂的不一致性

