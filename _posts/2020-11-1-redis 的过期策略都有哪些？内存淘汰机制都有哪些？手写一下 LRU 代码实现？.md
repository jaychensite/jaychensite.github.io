---
layout: post
title: "redis 的过期策略都有哪些？内存淘汰机制都有哪些？手写一下 LRU 代码实现？"
date: 2020-11-1 
description: "redis 的过期策略都有哪些？内存淘汰机制都有哪些？手写一下 LRU 代码实现？"
tag: Redis
---   

### redis 过期策略
	redis 过期策略是：定期删除+惰性删除。

##### 定期删除
	所谓定期删除,指的是redis默认每隔100ms就随机抽取一些过期的key，检查是否过期，如果过期就删除。

假设你往redis存了100w个key，都设置了过期时间，你每隔几百ms就扫描全部过期key，这将是一场性能上的灾难。cpu负载会很高，redis基本上会面临死掉。这里需要注意一下 **redis所谓的定期删除并不是每隔几百ms就扫描全部的key，而是随机抽取一些key检查是否过期，如果过期就删除**

但是此时会有一个问题，定期删除随机抽取一批过期的key进行检查，这种情况就会导致很多过期key没有及时清理，占用redis内存。此时怎么办？？？redis针对此问题设计了一个惰性删除。


#### 惰性删除
	所谓定期删除指的是你在访问某一个key时，redis会检查key是否过期，如果过期将会删除，什么都不会返回。
	
redis默认使用定期删除+惰性删除实现了过期策略。但此时还有一个问题，就是redis内存满了怎么办？？？这时候redis淘汰策略上场。


### 内存淘汰机制

redis 内存淘汰机制有以下几个：

1.noeviction: 当内存不足以容纳新写入数据时，新写入操作会报错，这个一般没人用吧，实在是太恶心了。

2.allkeys-lru：当内存不足以容纳新写入数据时，在键空间中，移除最近最少使用的 key（这个是最常用的）。

3.allkeys-random：当内存不足以容纳新写入数据时，在键空间中，随机移除某个 key，这个一般没人用吧，为啥要随机，肯定是把最近最少使用的 key 给干掉啊。

4.volatile-lru：当内存不足以容纳新写入数据时，在设置了过期时间的键空间中，移除最近最少使用的 key（这个一般不太合适）。

5.volatile-random：当内存不足以容纳新写入数据时，在设置了过期时间的键空间中，随机移除某个 key。

6.volatile-ttl：当内存不足以容纳新写入数据时，在设置了过期时间的键空间中，有更早过期时间的 key 优先移除。

#### 手写LRU
[实现LRU](http://101.200.221.53:4000/2020/11/%E5%AE%9E%E7%8E%B0LRU%E7%AE%97%E6%B3%95/)
